# 大纲
- IPSEC协议的两个基本协议：鉴别头协议AH和有效载荷封装协议；
- IPSEC 的两个工作模式：传输模式和隧道模式；
- TLS协议握手过程、中间人攻击；
- VPN基本原理，VPN技术在TLS和IPSEC层面实现
- 防火墙基本原理
[AH协议与ESP协议简析_ah esp-CSDN博客](https://blog.csdn.net/bytxl/article/details/16825251)
## Authentication Header (AH) protocol
AH协议提供：数据源身份鉴别、数据完整性验证，但不提供机密性
工作方式
- 完整性验证：通过杂凑函数产生的校验值
- 数据源身份验证：计算验证码时加入一个共享密钥（HMAC）
- AH报头中的序列号防止重放攻击

> 使用计算机 A 的 Alice 将数据发送给使用计算机 B 的 Bob。IP 报头、AH 报头和数据的完整性都得到保护。这意味着 Bob 可以确定确实是 Alice 发送的数据并且数据未被修改。完整性与身份验证是通过在 IP 报头与 IP 负载之间置入的 AH 报头提供的。
 
## Encapsulation Security Payload (ESP) protocol
ESP协议还可以提供机密性
- 相比于AH，完整性保护更弱。只保护IP头后面的部分，但更灵活
	- 例如AH报文经过NAT(Network Address Translation)更改源地址后，接收端鉴别失败
- 另外一个功能：加密。加密IP包载荷部分，或加密整个IP包，重新打包进行传输
## 运行模式
- 传输模式：保护内容是IP包的载荷。通常只适用于两台主机之间的安全通信
	- |IP头|IPSec|TCP/UDP头|保护内容|ESP尾|
- 隧道模式，保护内容：整个IP包；保护范围：两个IPSec网关之间
	- |新IP头|IPSec|IP头|TCP/UDP头|保护内容|ESP尾|
# VPN
在公用通信设施（例如Internet）上加入安全机制，搭建而成的逻辑上的虚拟子网
- 任意两个节点之间的连接并没有传统专网所需的端到端的物理链路
- 是通过隧道技术在公共数据网络上虚拟出一条点到点的专线技术
## IPSec VPN
建立IPSec/IKE VPN流程如下
1. 主机或网关B向远程主机或网关A发送VPN建立请求
2. A产生一个随机数，并将其发送给B
3. B使用这个随机数加密预先通过IKE分享的密钥，将结果发送给A
4. A也用该随机数将B发来的结果解密，与预先分享的密钥比较，如果匹配，则使用这个密钥加密公钥，发送给B
5. B使用该公钥来建立它与A之间的IPSec SA，VPN隧道建立
## SSL VPN
- SSL工作在传输层和应用层之间，不会改变IP报文头和TCP报文头，不会影响原有网络拓扑.
- TLS协议是IETF将SSL协议的进一步标准化,基本上，SSL 3.0等于TLS 1.0

# TLS握手
类似三次握手
![[Pasted image 20240102194839.png]]
# 中间人攻击
- 能够通过ARP 欺骗、DNS 欺骗或者浏览器数据重定向等欺骗技术，使得SSL客户端C和服务器端S的数据都流向SSL MITM攻击机M
- SSL客户端用户在接收到SSL MITM攻击机伪造的数字证书后，被骗取对该证书的信任，并继续SSL连接
- SSL服务器未要求进行SSL客户端身份鉴别

![[Pasted image 20240102195605.png]]
# 防火墙
防火墙是位于两个(或多个)网络间，实施网间访问控制的一组组件的集合，它满足以下条件：
- 内部和外部之间的所有网络数据流必须经过防火墙；
- 只有符合安全政策的数据流才能通过防火墙；
- 防火墙自身能抗攻击；
`分类：`
- 包过滤技术
- 状态检测防火墙:通过对连接的跟踪功能，实现对数据包状态检测，从而进行过滤
- 应用级网关技术:应用层上建立协议过滤和转发功能
	依靠特定的逻辑判定是否允许数据包通过。一旦满足逻辑，则防火墙内外的计算机系统建立直接联系，防火墙外部的用户便有可能直接了解防火墙内部的网络结构和运行状态，这有利于实施非法访问和攻击。
- 代理服务器技术:将所有跨越防火墙的网络通信分为两段，提供应用层服务的控制，在内部网络向外部网络申请服务时提供中转服务
## 包过滤技术
工作在TCP/IP协议栈的网络层
`基本思想`
- 对于每个进来的包，适用一组规则，然后决定转发或者丢弃该包
- 往往配置成双向的(出站和入站)
- 通常在路由器上实现,实际上是一种网络层的访问控制机制
