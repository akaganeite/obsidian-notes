# 大纲
- 可信计算的基本功能：公钥认证、完整性度量、证明；
- CRTM和DRTM的概念及区别；
- TCG软件栈TSS的基本架构和作用；
- BIOS如何与TPM模块交互
[TCM、TPM、TPCM-CSDN博客](https://blog.csdn.net/xiaoju14/article/details/109717146)

# 可信计算的基本功能
- 可信计算的目的是：在假定客户端软件在使用过程中可能遭受破坏的情况下，保护敏感信息，不被窃取或者不被恶意代码使用。
1. 公钥认证功能
	- 采用硬件方式在TPM内部产生公私钥对、以及签名、验证、加密和解密操作
	- 即使私钥的拥有者也无法取得私钥。
	- 阻止外部恶意代码使用私钥
1. 完整性度量
	通过检查PCR度量值的变化（Platform Configuration Register，PCR），发现恶意程序的存在
3. 证明功能
	搜集PCR的所有软件度量列表，然后用TPM私钥签名，向远端证明软件的安全
# TCG 软件栈 TSS 的基本架构和作用
- TSS以厂商无关的方式为 上层 提供 TPM的所有功能
## 架构/组成：
![[Pasted image 20240103154019.png]]
- TCG设备驱动程序库TDDL
	- TDDL提供与TPM进行交互的API库：
	- 应用程序可以直接通过TDDL与TPM通信，如嵌入式应 用程序
	- 大多数情况下，TCS是TDDL的唯一使用者
- TCG核心服务TCS
	- TCS提供TSS的核心服务，包括以下几个任 务：
		- 管理TPM资源
		- TPM命令数据库产生器，把TCS API请求转成 TPM能够识别的字节流
		- 同步来自TSP的应用程序访问
		- TCS一般是TDDL的唯一使用者
- TCG服务提供者TSP
	- TSP层以共享对象或者动态链接库的形式被 应用程序 调用
		- TSP接口Tspi对外提供了TPM的所有功能
		- Tspi被设计为每条API都和一种对象类关联
		- TSS1.1规范规定了7中对象类型：上下文对象、数 据对象、TPM对象、策略对象、PCR集合对象、散 列对象和密钥对象

# BIOS 如何与 TPM 模块交互
- BIOS通过TPM访问函数与TPM模块交互
	- TCG_HashLogExtendEvent:计算输入函 数的散列值，创建事件日志文件，并将散列 值扩展到某个PCR中
	- TCG_PassThroughToTPM:给TPM发送一 个命令字节流
- 应用程序通过TDDL与TPM会话
	- TDDL：TCG设备驱动库，是应用程序用来 和直接和TPM进行通信的接口
	- 应用程序可以通过TDDL直接和TPM通信
	- 或者通过TCG软件栈TSS调用TDDL与TPM设备 通信

完整性度量的应用，比如区块链区块头的完整性保护原理等

# CRTM 和 DRTM 的概念及区别；
CRTM 和 DRTM是TCG定义的两种可信启动方法
## 静态可信根CRTM
基于假定：起始代码是不可更改的
静态可信根启动过程：
1. CRTM从BIOS的一段固定的可信代码（不能被修改）开始，在把控制权交给下一段代码之前，这段代码会 去度量下一段将要执行的代码，并将度量结果扩展到PCR，这个度量信任链贯穿整个启动过程。
2. 当系统启动完成后，PCR的结果可以刻画所有发给TPM的度量值
3. 用一个对称密钥加密根文件系统，这个密钥是封装过的，封装密钥为保证系统内核可信的PCR值（即正确的度量值）若根文件系统密钥恢复失败，意味着系统启动过程 不可信（PCR值匹配不成功），启动成功，则系统一定是可信的（PCR值匹配成功）
## 动态可信度量根DRTM
### 静态可信根CRTM存在的不足
- 可扩展性：过长的信任链不便于测量。需要确 保组成信任链的所有部件的可信性，依赖多个 组件的度量值及其次序，给系统更新带来麻烦
- 度量的时机：CRTM保证的是装载时安全，而不 保证运行时安全
- 度量的范围：CTRM需要对系统所有的可执行文件，包括可执行文件、库文件、脚本文件等都进行度量
### 动态可信度量根DRTM
- DRTM旨在实现信任根的随时随地启动，以及可信启动过程的可重复
- DRTM需要CPU处理器的配合
- DRTM的核心理念是：引入新的CPU指令，创建可控和可认证的执行环境，该环境不受系统中任何组件的影响，确保该指令下的加载的程序执行不会被篡改
## CRTM 和 DRTM的区别
- CRTM不需要CPU的配合，而DRTM需要
- CRTM保证的是装载时安全，而不 保证运行时安全
- CTRM需要对系统所有的可执行文件进行度量
