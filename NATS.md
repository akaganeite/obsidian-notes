# 消息格式解析

1. 尽可能的避免内存分配 
2. 尽可能的避免内存复制(zero copy) 

#### 主题的树状组织

按照前面的描述当客户端在一个主题下pub消息的时候,服务器要能找到所有对这个主题感兴趣的客户端,因为要支持*和>的模糊匹配,使用trie树来组织比较合理.

明显这里的trie树是系统的核心数据,每一次client的pub都要来这里查找所有相关的sub,如果这里设计的不好肯定会造成系统的瓶颈. 1. 这颗trie树是全局的,每一次新的订阅和连接的断开都需要更新 2. 每一次pub都需要在树中查找. 所以树的访问必须带锁;为了避免重复查找



## 消息格式解析的思路

出于性能考虑,应该考虑如下问题: 1. 尽可能的避免内存分配 2. 尽可能的避免内存复制(zero copy) 3. 不要使用正则表达式去匹配